// prisma/schema.prisma
// Define your database models

generator client {
  provider   = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}


// model

enum ProductCategory {
  MOBILE
  LAPTOP
  WATCH
  OTHER
}

model Otp {
  id        String   @id @default(cuid())
  mobile    String
  code      String
  expiresAt DateTime
  used      Boolean  @default(false)
  attempts  Int      @default(0)
  createdAt DateTime @default(now())

  @@index([mobile])
}

model OtpSession {
  id        String   @id @default(cuid())
  mobile    String
  apiKey    String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([mobile])
}

model User {
  id        String    @id @default(cuid())
  userName  String
  email     String    @unique
  mobile    String
  password  String
  ban       Boolean   @default(false)
  role      UserRole  @default(user)
  avatarUrl String?
  addresses Address[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  solds     Sold[]

  @@index([mobile])
}

model Banner {
  id        String   @id @default(cuid())
  title     String
  tooltip   String
  URL       String
  image     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Product {
  id          String          @id @default(uuid())
  name        String
  catagory    ProductCategory
  description String?
  price       Float?          @default(0.0)
  quantity    Int?            @default(0)
  image       Image[]
  soldItems   SoldItem[]
}

model Image {
  id        String   @id @default(uuid())
  image     String
  product   Product? @relation(fields: [productId], references: [id])
  productId String?
}

model Address {
  id       String @id @default(cuid())
  user     User   @relation(fields: [userId], references: [id])
  userId   String
  address  String
  city     String
  Province String
}

model Sold {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id])

  items SoldItem[]

  total     Float
  createdAt DateTime @default(now())
}

model SoldItem {
  id String @id @default(cuid())

  soldId String
  sold   Sold   @relation(fields: [soldId], references: [id])

  productId String
  product   Product @relation(fields: [productId], references: [id])

  quantity Int   @default(1)
  price    Float

  createdAt DateTime @default(now())
}

enum UserRole {
  user
  admin
}
